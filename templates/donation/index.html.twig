{% extends 'base.html.twig' %}

{% block title %}Gestion des Dons{% endblock %}

{% block body %}
    <h1>Tous les Dons</h1>

    <form method="get" class="row g-3 mb-3">
        <div class="col-md-6">
            <label for="donation-search" class="form-label">Recherche</label>
            <input
                type="text"
                id="donation-search"
                name="q"
                class="form-control"
                placeholder="Nom, email, type, description..."
                value="{{ search }}"
            >
        </div>
        <div class="col-md-3">
            <label for="donation-sort" class="form-label">Trier par</label>
            <select id="donation-sort" name="sort" class="form-select">
                <option value="dateDon" {{ sort == 'dateDon' ? 'selected' : '' }}>Date</option>
                <option value="donateur" {{ sort == 'donateur' ? 'selected' : '' }}>Donateur</option>
                <option value="type" {{ sort == 'type' ? 'selected' : '' }}>Type</option>
                <option value="charity" {{ sort == 'charity' ? 'selected' : '' }}>Cause</option>
                <option value="amount" {{ sort == 'amount' ? 'selected' : '' }}>Montant</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="donation-direction" class="form-label">Ordre</label>
            <select id="donation-direction" name="direction" class="form-select">
                <option value="DESC" {{ direction == 'DESC' ? 'selected' : '' }}>DÃ©croissant</option>
                <option value="ASC" {{ direction == 'ASC' ? 'selected' : '' }}>Croissant</option>
            </select>
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary">Appliquer</button>
            <a href="{{ path('app_donation_index') }}" class="btn btn-outline-secondary">RÃ©initialiser</a>
        </div>
    </form>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Donateur</th>
                <th>Cause</th>
                <th>Type</th>
                <th>Montant</th>
                <th>Photo</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
        {% for donation in donations %}
            <tr>
                <td>{{ donation.dateDon|date('d/m/Y H:i') }}</td>
                <td>
                    {% if donation.donateur %}
                        {{ donation.donateur.prenom }} {{ donation.donateur.nom }}
                        {% if donation.anonymous %}
                            <span class="badge bg-secondary ms-1">anonyme public</span>
                        {% endif %}
                    {% else %}
                        Anonyme
                    {% endif %}
                </td>
                <td>{{ donation.charity ? donation.charity.title : '-' }}</td>
                <td><span class="badge bg-info">{{ donation.type.libelle }}</span></td>
                <td>{{ donation.amount is not null ? donation.amount|number_format(2, '.', ' ') : '-' }}</td>
                <td>
                    {% if donation.photo %}
                        <a href="{{ asset(donation.photo) }}" target="_blank" rel="noopener">Voir</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ donation.description }}</td>
            </tr>
        {% else %}
            <tr>
                <td colspan="7">Aucun don enregistré.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
